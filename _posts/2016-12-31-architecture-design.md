---
layout: post
title: 架构设计
date: 2016-12-31
categories: architecture
tags: [architecture]
description: 架构设计的方法论
---

> 本文的主要内容来自温昱的著作[一线架构师实践指南](https://book.douban.com/search/%E6%B8%A9%E6%98%B1)中的一些论点，加上自己的一些感受

### 架构的评判

一流的架构是每个程序设计人员为之奋斗而无法具体说出难以达到的境界，因为这本就是一个即主观又非常客观的论断。主观是指在特定的每一个人对待架构完善程度的判断标准不一，而标准的不同就会带来判断上的区别；而客观又是一流的软件或者架构之间又存在非常多的共性特点，我们可以给一流的架构做出这样的定义：简明、灵活而清晰，能够通过创造性的机制解决复杂的问题，这些机制语义丰富，可应用于其他可能完全无关的问题，一流意味着恰当的抽象，意味着通过新的途径，合理利用有限的资源。

### 架构的分层

在进行软件架构设计的时候，大部分会优先考虑如何进行开发的问题，如果是使用水平优先的方式，那么我们需要预先把所有的功能都进行定义，然后再逐步铺开进行开发；如果为了能够更好地利用交互，及时得到用户的反馈，那么我们会选择垂直优先的这种方式，采用垂直优先策略我们需要把垂直相关的系统功能跟架构支持先定义好，保证可以在这个基础上实现一个较小但是完整的系统功能。

因此在常见的分层，架构之上，我们还会构建出对应的分区规则。分区构建在分层之内，其粒度比分层更小。一般一个具体的垂直功能只跟一个分层中具体的某一个分区有关系。垂直划分的模式更接近目前比较流行的微服务的概念，通过将开发团队和团队目标分割成为彼此较为独立的服务，便于快速迭代和敏捷开发。定义好分层跟分区试点进行迭代开发的关键。

### 解耦和分离

如何通过关注点分离来达到系统中的一部分发生了改变，不会影响其他部分的目标？

首先可以通过职责划分来分离关注点，面向对象设计的关键所在就是职责的识别和分配，每个功能的完成都是通过一系列职责组成的协作链条完成的，当不同职责被合理分离之后，为了实现新的功能，只需构建新的协作链条，而需求变更也往往只会影响到少数职责的定义和实现。

其次，可以利用软件系统各部分的通用性不同，进行关注点分离，不同的通用程度意味着变化的可能性不同，将通用性不同的部分分离，有利于通用部分的重用，也便于对专用部分修改。

为什么要进行模块的划分，其实是为了解决更复杂的问题。分是手段，和是目的，不能合在一起，支持更高层次功能的模块，又有何用呢。

架构的设计又是不断迭代的一个过程，罗马不是一天建成的，需求，对架构的驱动作用是伴随的架构师不断设计中间成果，不断质疑中间成果，不断调整完善，细化中间成果的过程逐渐展开的。

先考虑结构功能的划分手段，是上面所用分成的细化分区的引入机制的提取，然后让切分出的职责协作起来，验证能够完成功能，这个工作可以借助时序图图完成。

此时，结构和行为各方面进行一定的设计，就应该开始质疑自己的设计

架构师要从两个角度

- 质疑功能方面，特殊的功能能支持吗？
- 质量方面，耦合性重用性，性能等怎么样？

通过这种不断迭代更新的过程，将设计不断的深入。

逻辑架构的设计应该使用，结构设计和行为设计相分离。使用灰盒包图，关注核心系统中的关键类。从而更明白地说明子系统之间的协作关系。

![architecture](http://i.imgur.com/mnIPlcE.jpg)

### 架构的权衡

除去逻辑架构上面的设计，物理架构主要围绕物理节点，网络，软件单元，数据单元等进行，需要同时艰苦高性能，次序可用，可伸缩以及经济性和技术可实现性等，实际上架构的决策都取决于平衡的选择。

从思维要点层面，开销与争用是核心，正是通过降低开销避免争用来实现高性能高伸缩性的目标。

如何进行开发与架构设计的权衡，在架构设计中重视开发框架视图，让开发人员看到他关心的，程序单元源代码，目录结构等概念。架构设计不可高来高去，能支持并行的详细设计，是架构设计进行到什么程度的标志。

避免高来高去，应该更多地给出对关键功能细化的指导设计，而非给出没有判断标准的定性描述，这种信息的传递是无效的。程序员应该参与到架构的设计中，不可以将高层次的概念架构等同于开发架构，而应该逐步细化到可以执行并行开发。做到高屋建瓴。







